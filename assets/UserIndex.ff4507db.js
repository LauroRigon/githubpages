import{Q as B}from"./QInnerLoading.e500c865.js";import{aC as q,Y as F,Z as O,r as x,H as m,I as A,J as s,K as r,bq as h,a1 as f,$ as y,bv as M,L as D,a2 as p,bp as U,bx as H,A as L,M as Q,a3 as Y,t as J,a_ as K,a5 as Z,b8 as j,w as G,aE as R,a0 as c,aF as W}from"./index.0c1b9320.js";import{Q as X}from"./QTable.2b218a80.js";import{a as ee,n as T}from"./NotifyHelper.aabcb271.js";import{u as ae}from"./usePaginatedResourceListing.ce68d7c3.js";import{Q as te,C as se}from"./QSpace.53b35ea1.js";import{r as N,t as C,a as re,g as P}from"./index.a0b4d683.js";import"./QList.7d15dc0d.js";import"./QSelect.7759fa6b.js";import"./QMenu.795138f0.js";function ne(t,a){N(2,arguments);var e=C(t),n=re(a);return isNaN(n)?new Date(NaN):(n&&e.setDate(e.getDate()+n),e)}function V(t){N(1,arguments);var a=C(t);return a.setHours(0,0,0,0),a}var le=864e5;function oe(t,a){N(2,arguments);var e=V(t),n=V(a),o=e.getTime()-P(e),l=n.getTime()-P(n);return Math.round((o-l)/le)}function $(t,a){var e=t.getFullYear()-a.getFullYear()||t.getMonth()-a.getMonth()||t.getDate()-a.getDate()||t.getHours()-a.getHours()||t.getMinutes()-a.getMinutes()||t.getSeconds()-a.getSeconds()||t.getMilliseconds()-a.getMilliseconds();return e<0?-1:e>0?1:e}function ie(t,a){N(2,arguments);var e=C(t),n=C(a),o=$(e,n),l=Math.abs(oe(e,n));e.setDate(e.getDate()-o*l);var g=Number($(e,n)===-o),i=o*(l-g);return i===0?0:i}async function ue(t){return(await q.get("users",{params:{...t}})).data}async function de(t){return(await q.delete(`users/${t}/change-status`)).data}var z={list:ue,changeStatus:de};const ce={class:"text-h5 q-mt-sm q-mb-xs text-center"},me={class:"text-center"},fe={class:"text-h6"},ge={class:"q-ml-sm"},ve=Q(" Ao inativar a conta, a ativa\xE7\xE3o da mesma s\xF3 poder\xE1 ser realizada em 30 dias "),pe=Q(" Para ativar a conta, \xE9 necess\xE1rio aguardar 30 dias ap\xF3s a desativa\xE7\xE3o. "),_e={key:0,class:"d-block text-center"},he=F({__name:"UserCard",props:{id:{type:Number},name:{type:String},email:{type:String},deleted_at:{type:String}},emits:["update:user"],setup(t,{emit:a}){var u;const e=t,n=O(),o=x((u=n.getUser)==null?void 0:u.id),l=x(!1),g=x(!1),i=x(null),S=()=>e.deleted_at?"Ativar":"Inativar",k=()=>{if(i.value=ie(ne(new Date(e.deleted_at),30),new Date),i.value>0)return`Restam ${i.value} dias`;if(i.value===0)return`Resta ${i.value} dia`},I=()=>e.deleted_at?"restore":"remove_circle",b=()=>e.deleted_at?"green":"red",d=()=>e.deleted_at?"Ativar":"Inativar";async function w(){g.value=!0;try{await z.changeStatus(e.id),ee("Conta atualizada"),l.value=!1,a("update:user")}catch(_){if(!j.isAxiosError(_))throw _;T(_.response&&_.response.data.message)}finally{g.value=!1}}return(_,v)=>(m(),A(Z,null,[s(U,{class:"my-card",flat:"",bordered:""},{default:r(()=>[s(h,null,{default:r(()=>[f("div",ce,y(e.name),1),f("div",me,y(e.email),1)]),_:1}),s(M,null,{default:r(()=>[s(te),e.deleted_at?(m(),D(p,{key:1,flat:"",color:"green",label:"Ativar",onClick:v[1]||(v[1]=E=>l.value=!0)})):(m(),D(p,{key:0,disable:o.value===e.id,flat:"",color:"red",label:"Inativar",onClick:v[0]||(v[0]=E=>l.value=!0)},null,8,["disable"]))]),_:1})]),_:1}),s(K,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=E=>l.value=E),"transition-show":"scale","transition-hide":"scale"},{default:r(()=>[s(U,null,{default:r(()=>[s(U,{class:H(["bg-"+b()+"-6","text-white"])},{default:r(()=>[s(h,null,{default:r(()=>[f("div",fe,[s(L,{name:I()},null,8,["name"]),Q(" "+y(S()),1)])]),_:1}),s(h,{class:"q-pt-none"},{default:r(()=>[f("span",ge,[f("strong",null,y(e.name),1)])]),_:1})]),_:1},8,["class"]),e.deleted_at?(m(),D(h,{key:1},{default:r(()=>[pe,i.value>=0?(m(),A("div",_e,[f("h6",null,y(k()),1)])):Y("",!0)]),_:1})):(m(),D(h,{key:0},{default:r(()=>[ve]),_:1})),s(M,{align:"right"},{default:r(()=>[J(s(p,{flat:"",label:"N\xE3o",color:"primary"},null,512),[[se]]),s(p,{flat:"",size:"small",label:d(),color:b(),disable:e.deleted_at!==null&&i.value>0,onClick:w},null,8,["label","color","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ye={class:"q-pa-lg"},xe={class:"q-pa-xs col-lg-3 col-md-4 col-sm-12 col-xs-12"},Ae=F({__name:"UserIndex",async setup(t){let a,e;const n=[{name:"name",label:"Nome",align:"left",field:"name"},{name:"email",label:"Email",field:"email",align:"center"}],o=x(null);G(o,async()=>await l());const{fetchData:l,fetchNextPage:g,fetchPreviousPage:i,hasPreviousPage:S,hasNextPage:k,data:I,isLoading:b}=([a,e]=R(async()=>ae(async d=>await z.list({cursor:d,name:o.value}),d=>T(d.response&&d.response.data.message))),a=await a,e(),a);return(d,w)=>(m(),A("div",ye,[s(X,{title:"Usu\xE1rios","row-key":"name",rows:c(I),columns:n,loading:c(b),"rows-per-page-options":[0],grid:""},{loading:r(()=>[s(B,{showing:"",color:"primary"})]),"top-right":r(()=>[s(W,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=u=>o.value=u),placeholder:"Nome do usu\xE1rio",debounce:300},{append:r(()=>[s(L,{name:"search"})]),_:1},8,["modelValue"])]),item:r(u=>[f("div",xe,[s(he,{id:u.row.id,name:u.row.name,email:u.row.email,deleted_at:u.row.deleted_at,"onUpdate:user":c(l)},null,8,["id","name","email","deleted_at","onUpdate:user"])])]),pagination:r(()=>[s(p,{icon:"chevron_left",color:"grey-8",round:"",dense:"",flat:"",disable:!c(S),onClick:c(i)},null,8,["disable","onClick"]),s(p,{icon:"chevron_right",color:"grey-8",round:"",dense:"",flat:"",disable:!c(k),onClick:c(g)},null,8,["disable","onClick"])]),_:1},8,["rows","loading"])]))}});export{Ae as default};
